{% extends 'frontend/base.html' %}

{% block title %}–¢–µ—Å—Ç –∞–Ω–∞–ª–∏–∑–æ–≤ - HorseAI{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto; padding: 40px;">
    <h1 style="color: var(--text-primary); margin-bottom: 30px;">üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–æ–≤</h1>
    
    <div style="background: var(--bg-card); padding: 30px; border-radius: var(--radius-lg); margin-bottom: 30px;">
        <h2 style="color: var(--text-primary); margin-bottom: 20px;">–î–µ–º–æ-—Ñ—É–Ω–∫—Ü–∏–∏</h2>
        
        <div style="display: grid; gap: 15px;">
            <button onclick="createDemoAnalysis()" 
                    style="padding: 15px; background: linear-gradient(135deg, var(--accent), var(--earth)); 
                           color: white; border: none; border-radius: var(--radius); font-weight: 600; cursor: pointer;">
                üöÄ –°–æ–∑–¥–∞—Ç—å –¥–µ–º–æ-–∞–Ω–∞–ª–∏–∑
            </button>
            
            <button onclick="checkAnalyses()"
                    style="padding: 15px; background: var(--bg-hover); color: var(--text-primary); 
                           border: 1px solid var(--border); border-radius: var(--radius); font-weight: 600; cursor: pointer;">
                üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–Ω–∞–ª–∏–∑—ã –≤ –±–∞–∑–µ
            </button>
            
            <a href="/analysis/results/" 
               style="padding: 15px; background: var(--sage); color: white; text-align: center; 
                      border-radius: var(--radius); font-weight: 600; text-decoration: none; display: block;">
                üìä –ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
            </a>
        </div>
    </div>
    
    <div id="result" style="margin-top: 30px; padding: 20px; background: var(--bg-card); border-radius: var(--radius);">
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
    </div>
</div>

<script>
async function createDemoAnalysis() {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<p style="color: var(--text-secondary);">‚è≥ –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–∞–Ω–∞–ª–∏–∑...</p>';
    
    try {
        const response = await fetch('/api/simple-analysis/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCookie('csrftoken'),
                'Content-Type': 'application/json'
            }
        });
        
        const data = await response.json();
        
        if (data.success) {
            resultDiv.innerHTML = `
                <div style="color: var(--sage);">
                    <h3>‚úÖ –î–µ–º–æ-–∞–Ω–∞–ª–∏–∑ —Å–æ–∑–¥–∞–Ω!</h3>
                    <p>ID –∞–Ω–∞–ª–∏–∑–∞: ${data.analysis_id}</p>
                    <p>${data.message}</p>
                    ${data.is_lame ? '<p style="color: var(--accent);">‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ö—Ä–æ–º–æ—Ç–∞</p>' : '<p>‚úÖ –•—Ä–æ–º–æ—Ç–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞</p>'}
                    <p>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ö—Ä–æ–º–æ—Ç—ã: ${(data.lameness_probability * 100).toFixed(1)}%</p>
                    <a href="/analysis/results/" style="color: var(--accent); text-decoration: underline;">
                        –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö ‚Üí
                    </a>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `<div style="color: #fca5a5;">
                <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                <p>${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
            </div>`;
        }
    } catch (error) {
        resultDiv.innerHTML = `<div style="color: #fca5a5;">
            <h3>‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏</h3>
            <p>${error.message}</p>
        </div>`;
    }
}

async function checkAnalyses() {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<p style="color: var(--text-secondary);">‚è≥ –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ...</p>';
    
    try {
        const response = await fetch('/analysis/results/?format=json');
        const text = await response.text();
        
        // –ü—ã—Ç–∞–µ–º—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON
        try {
            const data = JSON.parse(text);
            resultDiv.innerHTML = `
                <div style="color: var(--text-primary);">
                    <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–æ–≤</h3>
                    <p>–í—Å–µ–≥–æ –∞–Ω–∞–ª–∏–∑–æ–≤: ${data.count || 0}</p>
                    <p>–ê–Ω–∞–ª–∏–∑–æ–≤ —Å —Ö—Ä–æ–º–æ—Ç–æ–π: ${data.lame_count || 0}</p>
                </div>
            `;
        } catch {
            // –ï—Å–ª–∏ –Ω–µ JSON, –ø–æ–∫–∞–∂–µ–º —Ç–µ–∫—Å—Ç
            resultDiv.innerHTML = `
                <div style="color: var(--text-primary);">
                    <h3>üìä –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞</h3>
                    <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ <a href="/analysis/results/" style="color: var(--accent);">—Å—Å—ã–ª–∫–µ</a> —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</p>
                </div>
            `;
        }
    } catch (error) {
        resultDiv.innerHTML = `<div style="color: #fca5a5;">
            <p>‚ùå –û—à–∏–±–∫–∞: ${error.message}</p>
        </div>`;
    }
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>
{% endblock %}
