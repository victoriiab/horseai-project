{% extends 'frontend/base.html' %}

{% block title %}–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ - HorseAI{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto; padding: 30px;">
    <h1 style="color: #2c3e50;">üé¨ –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ</h1>
    <p style="color: #7f8c8d;">–ó–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∏–¥–µ–æ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–æ—Ö–æ–¥–∫–∏ –ª–æ—à–∞–¥–∏</p>
    
    <div style="background: #f8f9fa; padding: 30px; border-radius: 10px;">
        <form id="uploadForm" method="POST" action="/api/upload/simple/" enctype="multipart/form-data">
            {% csrf_token %}
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: bold; margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ –∂–∏–≤–æ—Ç–Ω–æ–µ:</label>
                <select name="animal_id" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px;">
                    <option value="1">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–Ω–Ω–∞—è –ª–æ—à–∞–¥—å (ID: 1)</option>
                    {% for animal in animals %}
                    <option value="{{ animal.animal_id }}">{{ animal.name }} (ID: {{ animal.animal_id }})</option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: bold; margin-bottom: 10px;">–í–∏–¥–µ–æ—Ñ–∞–π–ª:</label>
                <input type="file" name="video_file" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 6px;">
                <small style="color: #7f8c8d;">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: MP4, AVI, MOV, MKV (–¥–æ 500MB)</small>
            </div>
            
            <div style="background: #e8f5e9; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                <p style="margin: 0; color: #2c3e50;"><strong>üìä –ß—Ç–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:</strong></p>
                <ul style="margin: 10px 0 0 20px; color: #2c3e50;">
                    <li>–°–∏–º–º–µ—Ç—Ä–∏—è –ø–æ—Ö–æ–¥–∫–∏ –∏ –¥–≤–∏–∂–µ–Ω–∏–π</li>
                    <li>–ü—Ä–∏–∑–Ω–∞–∫–∏ —Ö—Ä–æ–º–æ—Ç—ã</li>
                    <li>–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –¥–≤–∏–∂–µ–Ω–∏–π</li>
                </ul>
            </div>
            
            <button type="submit" style="width: 100%; background: #4CAF50; color: white; border: none; padding: 16px; font-size: 18px; font-weight: bold; border-radius: 8px; cursor: pointer;">
                üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ
            </button>
        </form>
        
        <div id="result" style="margin-top: 20px; padding: 20px; background: white; border-radius: 8px; display: none;"></div>
    </div>
</div>

<!-- –°–ê–ú–´–ô –ü–†–û–°–¢–û–ô JavaScript -->
<script>
// –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    console.log('–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    
    var form = document.getElementById('uploadForm');
    if (!form) {
        console.error('–§–æ—Ä–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        return;
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
    form.addEventListener('submit', function(e) {
        e.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É
        
        console.log('–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª
        var fileInput = document.querySelector('input[name="video_file"]');
        if (!fileInput.files.length) {
            alert('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª');
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        var submitBtn = document.querySelector('button[type="submit"]');
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
        }
        
        // –°–æ–∑–¥–∞–µ–º FormData
        var formData = new FormData(form);
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º AJAX –∑–∞–ø—Ä–æ—Å
        fetch('/api/upload/simple/', {
            method: 'POST',
            body: formData
        })
        .then(function(response) {
            console.log('–û—Ç–≤–µ—Ç –ø–æ–ª—É—á–µ–Ω:', response.status);
            return response.json();
        })
        .then(function(data) {
            console.log('–î–∞–Ω–Ω—ã–µ:', data);
            
            if (data.success) {
                // –£—Å–ø–µ—Ö
                var resultDiv = document.getElementById('result');
                if (resultDiv) {
                    resultDiv.style.display = 'block';
                    resultDiv.innerHTML = 
                        '<h3 style="color: #4CAF50;">‚úÖ –í–∏–¥–µ–æ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!</h3>' +
                        '<p><strong>ID –≤–∏–¥–µ–æ:</strong> ' + data.video_id + '</p>' +
                        '<p><strong>–ñ–∏–≤–æ—Ç–Ω–æ–µ:</strong> ' + (data.animal_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ') + '</p>' +
                        '<p><strong>–î–∏–∞–≥–Ω–æ–∑:</strong> ' + (data.diagnosis || '–ù–æ—Ä–º–∞') + '</p>' +
                        '<p><strong>–•—Ä–æ–º–æ—Ç–∞:</strong> ' + (data.is_lame ? '–î–ê ‚ö†Ô∏è' : '–ù–ï–¢ ‚úÖ') + '</p>' +
                        '<p>–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã...</p>';
                }
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(function() {
                    window.location.href = '/analysis/results/';
                }, 3000);
                
            } else {
                // –û—à–∏–±–∫–∞
                throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
        })
        .catch(function(error) {
            console.error('–û—à–∏–±–∫–∞:', error);
            alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–Ω–æ–ø–∫—É
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ';
            }
        });
    });
    
    console.log('JavaScript –Ω–∞—Å—Ç—Ä–æ–µ–Ω');
});
</script>
{% endblock %}
