<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .test-area { margin: 30px 0; padding: 20px; border: 2px solid #4CAF50; border-radius: 10px; }
        h1 { color: #333; }
        input[type="file"], input[type="text"] { 
            padding: 10px; margin: 10px 0; width: 100%; max-width: 400px; 
            border: 1px solid #ddd; border-radius: 5px; 
        }
        button { 
            background: #4CAF50; color: white; border: none; 
            padding: 12px 24px; font-size: 16px; border-radius: 5px; 
            cursor: pointer; margin-top: 10px; 
        }
        button:hover { background: #45a049; }
        .result { 
            margin-top: 20px; padding: 15px; border-radius: 5px; 
            background: #f9f9f9; border-left: 4px solid #4CAF50; 
            white-space: pre-wrap; font-family: monospace; 
        }
        .success { background: #d4edda; border-left-color: #28a745; }
        .error { background: #f8d7da; border-left-color: #dc3545; }
    </style>
</head>
<body>
    <h1>üê¥ –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ –≤ HorseAI</h1>
    <p>–ü—Ä–æ—Å—Ç–∞—è —Ñ–æ—Ä–º–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ</p>
    
    <div class="test-area">
        <h2>Endpoint: /api/upload/simple/</h2>
        <form id="uploadForm" enctype="multipart/form-data">
            <div>
                <label>–í–∏–¥–µ–æ—Ñ–∞–π–ª (MP4, AVI):</label><br>
                <input type="file" name="video_file" accept=".mp4,.avi,.mov" required>
            </div>
            <div>
                <label>ID –∂–∏–≤–æ—Ç–Ω–æ–≥–æ:</label><br>
                <input type="text" name="animal_id" value="1" required>
            </div>
            <button type="submit">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ</button>
        </form>
        <div id="result" class="result"></div>
    </div>
    
    <div class="test-area">
        <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</h3>
        <ol>
            <li>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∏–¥–µ–æ—Ñ–∞–π–ª —Å –ª–æ—à–∞–¥—å—é</li>
            <li>–£–∫–∞–∂–∏—Ç–µ ID –∂–∏–≤–æ—Ç–Ω–æ–≥–æ (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å 1)</li>
            <li>–ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∏–¥–µ–æ"</li>
            <li>–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ –≤—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</li>
        </ol>
        <p><strong>–¢–µ—Å—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ:</strong> <code>/home/ais/shared/horseAI/horseai_project/api/uploads/167ba225_healthy_20_mirrored_hhFES5M.mp4</code></p>
    </div>
    
    <script>
    document.getElementById('uploadForm').onsubmit = async function(e) {
        e.preventDefault();
        
        const formData = new FormData(this);
        const resultDiv = document.getElementById('result');
        const submitBtn = this.querySelector('button[type="submit"]');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
        const originalBtnText = submitBtn.textContent;
        submitBtn.textContent = '‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...';
        submitBtn.disabled = true;
        
        resultDiv.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ...';
        resultDiv.className = 'result';
        
        try {
            const response = await fetch('/api/upload/simple/', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            
            if (data.success) {
                resultDiv.innerHTML = `<strong>‚úÖ –£—Å–ø–µ—Ö!</strong>\n\n` +
                                     `ID –≤–∏–¥–µ–æ: ${data.video_id}\n` +
                                     `–°–æ–æ–±—â–µ–Ω–∏–µ: ${data.message}\n` +
                                     `–ü—É—Ç—å: ${data.file_path}\n` +
                                     `–†–∞–∑–º–µ—Ä: ${(data.file_size / (1024*1024)).toFixed(2)} MB`;
                resultDiv.className = 'result success';
                
                // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    window.location.href = '/analysis/results/';
                }, 2000);
                
            } else {
                throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
            }
            
        } catch (error) {
            resultDiv.innerHTML = `<strong>‚ùå –û—à–∏–±–∫–∞:</strong>\n${error.message}`;
            resultDiv.className = 'result error';
            
        } finally {
            submitBtn.textContent = originalBtnText;
            submitBtn.disabled = false;
        }
    };
    
    // –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Å—Ç–∞
    console.log('–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    </script>
</body>
</html>
