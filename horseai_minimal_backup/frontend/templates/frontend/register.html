{% extends 'frontend/base.html' %}

{% block title %}–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è - HorseAI{% endblock %}

{% block extra_css %}
<style>
    .register-container {
        max-width: 500px;
        margin: 60px auto;
        padding: 40px;
        background: var(--bg-card);
        border-radius: var(--radius-lg);
        border: 1px solid var(--border);
        box-shadow: var(--shadow-lg);
    }

    .register-title {
        text-align: center;
        font-size: 28px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 30px;
    }

    .register-title::before {
        content: 'üêé';
        display: block;
        font-size: 48px;
        margin-bottom: 15px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        color: var(--text-secondary);
        font-size: 14px;
        font-weight: 500;
        margin-bottom: 8px;
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        background: var(--bg-dark);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        color: var(--text-primary);
        font-size: 16px;
        transition: all 0.3s ease;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: var(--glow);
    }

    .register-btn {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, var(--accent), var(--earth));
        color: white;
        border: none;
        border-radius: var(--radius);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 10px;
    }

    .register-btn:hover {
        background: linear-gradient(135deg, var(--accent-hover), var(--accent));
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
    }

    .register-links {
        text-align: center;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
    }

    .register-link {
        color: var(--text-secondary);
        text-decoration: none;
        font-size: 14px;
        transition: color 0.3s ease;
    }

    .register-link:hover {
        color: var(--accent);
    }

    .password-strength {
        margin-top: 5px;
        height: 4px;
        background: var(--bg-hover);
        border-radius: 2px;
        overflow: hidden;
    }

    .strength-bar {
        height: 100%;
        width: 0%;
        transition: width 0.3s ease, background-color 0.3s ease;
    }

    .strength-weak {
        background: #ef4444;
        width: 33%;
    }

    .strength-medium {
        background: #f59e0b;
        width: 66%;
    }

    .strength-strong {
        background: #10b981;
        width: 100%;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .terms-checkbox {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 15px;
    }

    .terms-checkbox input[type="checkbox"] {
        width: 18px;
        height: 18px;
        accent-color: var(--accent);
    }

    .terms-label {
        color: var(--text-secondary);
        font-size: 14px;
    }

    .terms-label a {
        color: var(--accent);
        text-decoration: none;
    }

    .terms-label a:hover {
        text-decoration: underline;
    }
</style>
{% endblock %}

{% block content %}
<div class="register-container">
    <h1 class="register-title">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ HorseAI</h1>

    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            {% if message.tags == 'success' %} ‚úÖ
            {% elif message.tags == 'error' %} ‚ùå
            {% else %} ‚ÑπÔ∏è {% endif %}
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}

    <form method="POST" action="/register/" id="registerForm">
        {% csrf_token %}
        
        <!-- –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
        <div class="form-row">
            <div class="form-group">
                <label class="form-label">–ò–º—è</label>
                <input type="text" name="first_name" class="form-input" required 
                       placeholder="–í–∞—à–µ –∏–º—è">
            </div>

            <div class="form-group">
                <label class="form-label">–§–∞–º–∏–ª–∏—è</label>
                <input type="text" name="last_name" class="form-input" required 
                       placeholder="–í–∞—à–∞ —Ñ–∞–º–∏–ª–∏—è">
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-input" required 
                   placeholder="example@email.com">
        </div>

        <div class="form-group">
            <label class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <input type="text" name="username" class="form-input" required 
                   placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω" id="usernameInput">
            <div class="text-sm text-tertiary mt-1" id="usernameCheck"></div>
        </div>

        <div class="form-group">
            <label class="form-label">–ü–∞—Ä–æ–ª—å</label>
            <input type="password" name="password" class="form-input" required 
                   placeholder="–ù–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤" id="passwordInput">
            <div class="password-strength">
                <div class="strength-bar" id="passwordStrength"></div>
            </div>
            <div class="text-sm text-tertiary mt-1">
                –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
            <input type="password" name="password_confirm" class="form-input" required 
                   placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" id="passwordConfirm">
            <div class="text-sm text-tertiary mt-1" id="passwordMatch"></div>
        </div>

        <!-- –†–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div class="form-group">
            <label class="form-label">–í—ã —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ—Å—å –∫–∞–∫:</label>
            <div style="display: flex; gap: 20px; margin-top: 10px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="radio" name="role" value="owner" checked style="accent-color: var(--accent);">
                    <span style="color: var(--text-primary);">üë§ –í–ª–∞–¥–µ–ª–µ—Ü –ª–æ—à–∞–¥–µ–π</span>
                </label> 
            </div>
        </div>

        <!-- –°–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏ -->
        <div class="terms-checkbox">
            <input type="checkbox" name="terms" id="terms" required>
            <label for="terms" class="terms-label">
                –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="/terms/">—É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a> –∏ 
                <a href="/privacy/">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
            </label>
        </div>

        <button type="submit" class="register-btn" id="submitBtn">
            üöÄ –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
        </button>
    </form>

    <div class="register-links">
        <p style="color: var(--text-secondary); margin-bottom: 10px;">
            –£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç?
        </p>
        <a href="/login/" class="register-link">–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É</a>
        ‚Ä¢
        <a href="/" class="register-link">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.getElementById('passwordInput');
    const passwordConfirm = document.getElementById('passwordConfirm');
    const strengthBar = document.getElementById('passwordStrength');
    const passwordMatch = document.getElementById('passwordMatch');
    const usernameInput = document.getElementById('usernameInput');
    const usernameCheck = document.getElementById('usernameCheck');
    const submitBtn = document.getElementById('submitBtn');

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
    function checkPasswordStrength(password) {
        let strength = 0;
        
        if (password.length >= 8) strength++;
        if (/[A-Z]/.test(password)) strength++;
        if (/[0-9]/.test(password)) strength++;
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        strengthBar.className = 'strength-bar';
        
        if (strength === 0) {
            return 'weak';
        } else if (strength <= 2) {
            strengthBar.classList.add('strength-weak');
            return 'weak';
        } else if (strength === 3) {
            strengthBar.classList.add('strength-medium');
            return 'medium';
        } else {
            strengthBar.classList.add('strength-strong');
            return 'strong';
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
    function checkPasswordMatch() {
        const password = passwordInput.value;
        const confirm = passwordConfirm.value;
        
        if (!confirm) {
            passwordMatch.textContent = '';
            return false;
        }
        
        if (password === confirm) {
            passwordMatch.textContent = '‚úÖ –ü–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
            passwordMatch.style.color = '#86efac';
            return true;
        } else {
            passwordMatch.textContent = '‚ùå –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
            passwordMatch.style.color = '#fca5a5';
            return false;
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function checkUsername() {
        const username = usernameInput.value.trim();
        
        if (username.length < 3) {
            usernameCheck.textContent = '–ú–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
            usernameCheck.style.color = '#fca5a5';
            return false;
        }
        
        if (!/^[a-zA-Z0-9_]+$/.test(username)) {
            usernameCheck.textContent = '–¢–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã –∏ _';
            usernameCheck.style.color = '#fca5a5';
            return false;
        }
        
        // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —á–µ—Ä–µ–∑ AJAX
        usernameCheck.textContent = '‚úÖ –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ';
        usernameCheck.style.color = '#86efac';
        return true;
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    passwordInput.addEventListener('input', function() {
        checkPasswordStrength(this.value);
        checkPasswordMatch();
    });

    passwordConfirm.addEventListener('input', checkPasswordMatch);
    usernameInput.addEventListener('input', checkUsername);

    // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        const password = passwordInput.value;
        const confirm = passwordConfirm.value;
        const username = usernameInput.value;
        
        if (password.length < 8) {
            e.preventDefault();
            alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤');
            return;
        }
        
        if (password !== confirm) {
            e.preventDefault();
            alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç');
            return;
        }
        
        if (username.length < 3) {
            e.preventDefault();
            alert('–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤');
            return;
        }
        
        if (!document.getElementById('terms').checked) {
            e.preventDefault();
            alert('–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–≥–ª–∞—Å–∏—Ç—å—Å—è —Å —É—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è');
            return;
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        submitBtn.disabled = true;
        submitBtn.innerHTML = '‚è≥ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è...';
    });
});
</script>
{% endblock %}
