from web.database.models import User, Animal, Video, Analysis

def menu_items(request):
    """
    –ö–æ–Ω—Ç–µ–∫—Å—Ç-–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
    –î–æ–±–∞–≤–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é 'menu_items' –≤–æ –≤—Å–µ —à–∞–±–ª–æ–Ω—ã.
    """
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω - —Ç–æ–ª—å–∫–æ –≥–ª–∞–≤–Ω–∞—è –∏ –≤—Ö–æ–¥
    if not request.user.is_authenticated:
        items = [

            {'name': '–ì–ª–∞–≤–Ω–∞—è', 'url': '/', 'icon': 'üè†'},
            {'name': '–í–æ–π—Ç–∏', 'url': '/login/', 'icon': 'üîê'},
        ]
        return {'menu_items': items}
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    is_admin = False
    if request.user.is_authenticated:
        try:
            custom_user = User.objects.get(login=request.user.username)
            is_admin = custom_user.role_id in ['admin', 'superadmin']
        except User.DoesNotExist:
            is_admin = hasattr(request.user, 'is_staff') and request.user.is_staff
    
    # –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω - –º–µ–Ω—é —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    if is_admin:
        items = [
            {'name': '–ì–ª–∞–≤–Ω–∞—è', 'url': '/', 'icon': 'üè†'},
            {'name': '–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è', 'url': '/dashboard/', 'icon': 'üìä'},
            {'name': '–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å', 'url': '/admin/', 'icon': '‚öôÔ∏è'},
        ]
        return {'menu_items': items}
    
    # –ï—Å–ª–∏ –æ–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –ø–æ–ª–Ω–æ–µ –º–µ–Ω—é
    items = [
        {'name': '–ì–ª–∞–≤–Ω–∞—è', 'url': '/', 'icon': 'üè†'},
        {'name': '–ú–æ–∏ –ª–æ—à–∞–¥–∏', 'url': '/animals/', 'icon': 'üê¥'},
        {'name': '–ê–Ω–∞–ª–∏–∑ –ø–æ—Ö–æ–¥–∫–∏', 'url': '/video-upload/', 'icon': 'üìπ'},
        {'name': '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã', 'url': '/analysis/results/', 'icon': 'üìä'},
        {'name': '–†–∞—Ü–∏–æ–Ω', 'url': '/ration/', 'icon': 'ü•ó'},
    ]
    
    return {'menu_items': items}


def user_role(request):
    """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —à–∞–±–ª–æ–Ω–∞ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
    from django.contrib.auth.models import User as DjangoUser
    from web.database.models import User as CustomUser

    if not request.user.is_authenticated:
        return {'user_role': 'guest'}

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Django –ø—Ä–∞–≤–∞
    if hasattr(request.user, 'is_staff') and request.user.is_staff:
        return {'user_role': 'admin'}
    
    if hasattr(request.user, 'is_superuser') and request.user.is_superuser:
        return {'user_role': 'admin'}

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    try:
        custom_user = CustomUser.objects.get(login=request.user.username)
        if custom_user.role_id in ['admin', 'superadmin']:
            return {'user_role': 'admin'}
        else:
            return {'user_role': 'user'}
    except CustomUser.DoesNotExist:
        # –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫–∞—Å—Ç–æ–º–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ, –ø—Ä–æ–≤–µ—Ä—è–µ–º Django —Ç–∞–±–ª–∏—Ü—É
        try:
            django_user = DjangoUser.objects.get(username=request.user.username)
            if django_user.is_staff or django_user.is_superuser:
                return {'user_role': 'admin'}
            else:
                return {'user_role': 'user'}
        except DjangoUser.DoesNotExist:
            # –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏–≥–¥–µ - –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é user
            return {'user_role': 'user'}
